#!/usr/bin/python2.7
#r = requests.get(config.url + "false")
#r = requests.get(config.url + "true " + str(counter))
import requests
import time
from hosted import device, node, config, os

counter = 0
device.gpio.monitor(config.pin)
for (pin, state) in device.gpio.poll_forever():
    if state is True:
        counter += 1
        node.send('/counter:%d' % counter)
        url = config.db
        headers = {
            'Content-Type': 'application/json',
            "x-apikey": config.api
        }
        data = {
            "device_id": config.metadata['device_id'],
            "motion": counter,
            "timestamp": os.system('%m-%d-%Y')
        }
        req = requests.post(url, json=data, headers=headers)
        r = requests.get(config.url + str(req) + str(counter))
